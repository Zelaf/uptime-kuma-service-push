name: uptime-kuma-service-push
help: |-
  A bash script generator for Uptime-Kuma's Push Monitor.

  This script generates a script that checks if a service is running and pushes to Uptime-Kuma's Push Monitor. It uses systemctl to check the services and then uses curl to tell Uptime-Kuma if the service is up or down. If the service is down it will also add the last 5 lines of the journalctl logs to the message through tail.
version: 0.3.0
dependencies:
  - curl
  - tail
  - systemctl
  - journalctl
  - cat
  - readlink
  - echo
  - printf

commands:
  - name: generate
    alias: gen
    help: |-
      Generate a push monitor script.

      This will generate the script that pushes an update to Uptime-Kuma.

      If the service is up it sends an OK status and a message saying it's running.
      If the service is down it will send a DOWN status and a message saying the service is down. It will also append the last 5 lines from the log.
    filters:
      - "folder_exists"
    args:
      - name: service
        required: true
        help: |- 
          Service name

          Enter the name of the service that you will be checking. It will validate the service using systemctl to check if the service is active.
        validate: service
      - name: url
        required: true
        help: |-
          Push URL - Requires quotations: 'URL'

          It will validate the URL to make sure it contains parts of the API URL as well has the URL prefix.

          Copy and paste the whole URL from Uptime-Kuma's Push Monitor inside of single quotes, otherwise the URL won't be parsed correctly. See examples.
        validate: url
    examples:
      - uptime-kuma-service-push generate docker 'https://example.com/api/push/JSHs372KL8?status=up&msg=OK&ping='
      - uptime-kuma-service-push gen hostapd 'https://example.com/api/push/a02fD177b4?status=up&msg=OK&ping='
